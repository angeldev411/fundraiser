<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Raiserve | You + Us = A World of Change</title>
        <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1" media="(device-height: 568px)">
        <meta http-equiv="cleartype" content="on">
        <script src="bind_polyfill.js"></script>
        <link rel="stylesheet" href="/assets/css/style.css" />
        <link rel="stylesheet" href="/assets/css/font-awesome.min.css" />
    </head>

    <body>
        <div id="root"></div>
        <script src="/bundle.js"></script>
        <script src="/assets/js/jquery.min.js"></script>
        <script type="text/javascript">
        // TODO move this to another file
        $(document).ready(function () {
            var debug = true;

            var active = 0;

            var menuId = "#slide-menu";
            var toggleMenuButton = "#toggle-menu";
            var containerId = "#root .react-container";
            var pageId = "#page";

            var windowHeight = $(window).height();
            var menuWidth = $(menuId).width();

            var animationDelay = 200;

            // Initialize mobile menu
            initialize();

            function initialize() {
                console.log('Initializing mobile menu...');

                // Adjust menu size & position
                adjust();

                $(menuId).css('display', 'block');

                // Move menu to #root container
                $(menuId).appendTo(containerId);

                $(toggleMenuButton).on("click", function (e) {
                    e.preventDefault();
                    if (active)
                        close();
                    else
                        open();
                });

                $(window).on("resize", function () {
                    adjust();
                });

                if(debug) open();
            }

            function adjust(){
                console.log('Adjusting mobile menu...');

                windowHeight = $(window).height();
                menuWidth = $(menuId).width();

                $(menuId).height(windowHeight + 'px');

                if (!active) { // If menu is not active, replacing menu on standby position
                    $(menuId).css('right', -menuWidth+'px');
                }
            }

            function open(){
                active = 1;
                $(menuId).animate({
                    right: 0,
                }, animationDelay, function() {
                    // Animation complete.

                    // Bind #page to close menu when clicking on page content
                    bindPage();

                    //  Lock scroll position, but retain settings for later
                    var scrollPosition = [
                        self.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft,
                        self.pageYOffset || document.documentElement.scrollTop  || document.body.scrollTop
                    ];

                    var html = $('html'); // It would make more sense to apply this to body, but IE7 won't have that

                    html.data('scroll-position', scrollPosition);
                    html.data('previous-overflow', html.css('overflow'));
                    html.css('overflow', 'hidden');

                    window.scrollTo(scrollPosition[0], scrollPosition[1]);
                });
            }

            function close() {
                active = 0;
                $(menuId).animate({
                    right: -menuWidth+'px',
                }, animationDelay, function() {
                    // Animation complete.

                    // Unbind #page
                    unbindPage();

                    // Unlock scroll position
                    var html = $('html');
                    var scrollPosition = html.data('scroll-position');
                    html.css('overflow', html.data('previous-overflow'));
                    window.scrollTo(scrollPosition[0], scrollPosition[1])
                });
            }

            function bindPage() {
                $(pageId).on("click", function (e) {
                    e.preventDefault();
                    if (active) {
                        close();
                    }
                });
            }

            function unbindPage() {
                $(pageId).off("click");
            }


            // //stick in the fixed 100% height behind the navbar but don't wrap it
            // $('#slide-nav.navbar .container').append($('<div id="navbar-height-col"></div>'));
            //
            // // Enter your ids or classes
            // var toggler = '.navbar-toggle';
            // var pagewrapper = '#page-content';
            // var navigationwrapper = '.navbar-header';
            // var menuwidth = '100%'; // the menu inside the slide menu itself
            // var slidewidth = '80%';
            // var menuneg = '-100%';
            // var slideneg = '-80%';
            // $("#logo").on("click", toggler, function (e) {
            //     console.log("click click click!");
            //     var selected = $(this).hasClass('slide-active');
            //
            //     $('#slidemenu').stop().animate({
            //         left: selected ? menuneg : '0px'
            //     });
            //
            //     $('#navbar-height-col').stop().animate({
            //         left: selected ? slideneg : '0px'
            //     });
            //
            //     $(pagewrapper).stop().animate({
            //         left: selected ? '0px' : slidewidth
            //     });
            //
            //     $(navigationwrapper).stop().animate({
            //         left: selected ? '0px' : slidewidth
            //     });
            //
            //
            //     $(this).toggleClass('slide-active', !selected);
            //     $('#slidemenu').toggleClass('slide-active');
            //
            //
            //     $('#page-content, .navbar, body, .navbar-header').toggleClass('slide-active');
            //
            //
            // });
            //
            //
            // var selected = '#slidemenu, #page-content, body, .navbar, .navbar-header';
            //
            //
            // $(window).on("resize", function () {
            //
            //     if ($(window).width() > 767 && $('.navbar-toggle').is(':hidden')) {
            //         $(selected).removeClass('slide-active');
            //     }
            //
            //
            // });
        });
        </script>
    </body>
</html>
